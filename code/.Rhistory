geom_point()
final %>%
filter(dowel_density != "0000") %>%
ggplot(aes(x = pump_freq, y = eta, ymin = eta - 1.96*deta, ymax = eta + 1.96*deta, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_hue(h.start = 0) +
theme_minimal()
a = 1
b = 1
da = 1
db = 1
mutate_with_error(c ~ (a+b)/2)
tibble(a = 1, b = 1, da = 1, db = 1) %>% mutate_with_error(c ~ (a + b)/2)
tibble(a = 1, b = 2, da = 1, db = 1) %>% mutate_with_error(c ~ (a + b)/2)
final %>%
ggplot(aes(x = pump_freq, y = k_s, ymin = k_s - 1.96*dk_s, ymax = k_s + 1.96*dk_s, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("black","red","blue","green")) +
theme_minimal()
final %>%
ggplot(aes(x = pump_freq, y = k_s, ymin = k_s - 1.96*dk_s, ymax = k_s + 1.96*dk_s, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("black","blue","green","red")) +
theme_minimal()
knitr::opts_chunk$set(echo = TRUE, fig.pos = "!H", out.extra = "")
library(tidyverse)
pumpfiles <- list.files("../data/peristaltic pumps/")
trapfiles <- list.files("../data/sediment traps/")
pumpdate <- str_sub(pumpfiles,0,6)
trapdate <- str_sub(trapfiles,0,6)
pumpdata <- lapply(pumpfiles, function(x) read_csv(paste0("../data/peristaltic pumps/",x)))
names(pumpdata) <- pumpdate
x <- pumpdata
tidypump <- lapply(seq_along(x), function(i) {
select(x[[i]],
loc = Location,
ht = Height,
t = `time series`,
mvc = contains("(ppm)")) %>%
filter(t < 21) %>% #filter a few timepoints outside the normal window
mutate(t = (t-min(t)+1)*300, #convert from timestep to seconds
mvc = as.numeric(mvc),
date = as.numeric(names(x)[[i]])) %>%
filter(mvc<80, mvc>8) #outliers were removed based on the residual graph
}
)
pump <- bind_rows(tidypump)
pump <- pump %>%
#first 3 runs had starting sediment mass of 100g rather than 200g
filter(date > 181005) %>%
#we can't use runs without sediment mass
filter(as.character(date) %in% trapdate)
metadata <- read_csv("../data/run_metadata.csv")
pump <- left_join(pump, metadata, by = "date")
pumpfinal <- pump %>%
filter(growth_days==0, date != 190417, dowel_density != "0232")
trapdata <- lapply(trapfiles, function(x) read_csv(paste0("../data/sediment traps/",x)))
names(trapdata) <- trapdate
x <- trapdata
tidytrap <- lapply(seq_along(x), function(i) {
select(x[[i]], station = 1, pre = contains("pre"), post = contains("post"), sed = contains("sed")) %>%
mutate(date = names(x)[i]) %>%
mutate_at(vars(pre,post,sed,date), as.numeric)
}
)
trap <- bind_rows(tidytrap) %>%
filter(!is.na(sed))
trapfinal <- left_join(trap, metadata, by = "date") %>%
filter(date %in% pumpfinal$date)
mutate_with_error = function(.data, f) {
exprs = list(
# expression to compute new variable values
deparse(f[[3]]),
# expression to compute new variable errors
sapply(all.vars(f[[3]]), function(v) {
dfdp = deparse(D(f[[3]], v))
sprintf('(d%s*(%s))^2', v, dfdp)
}) %>%
paste(collapse='+') %>%
sprintf('sqrt(%s)', .)
)
names(exprs) = c(
deparse(f[[2]]),
sprintf('d%s', deparse(f[[2]]))
)
.data %>%
# the standard evaluation alternative of mutate()
mutate_(.dots=exprs)
}
library(lme4)
fits <- lmList(data = pumpfinal, log(mvc)~t | date)
summary(fits)
cbind(pumpfinal, pred = predict(fits)) %>%
ggplot() +
geom_point(aes(x = t, y = mvc), size = .75, alpha = .5) +
geom_line(aes(x = t, y = exp(pred)), color = "red") +
facet_grid(pump_freq~dowel_density) +
scale_x_continuous(breaks = c(0,3000,6000), limits = c(0,6000))
cbind(pumpfinal, resid = residuals(fits)) %>%
ggplot(aes(x = t, y = resid)) +
geom_point() +
geom_smooth()
fitdata <- coefficients(fits) %>%
mutate(k_t = -t) %>%
cbind(dk_t = summary(fits)[[4]][,,'t'][,2], date = as.numeric(row.names(coefficients(fits)))) %>%
left_join(metadata, by = "date")
fitdata %>%
ggplot(aes(x = pump_freq, y = k_t, ymin = k_t - 1.96*dk_t, ymax = k_t + 1.96*dk_t, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("black","blue","green","red")) +
theme_minimal()
final <- trapfinal %>%
group_by(date) %>%
summarise(m_trap = mean(sed)/1000,
dm_trap = sd(sed)/1000) %>% #average sediment in trap converted from mg to g
mutate_with_error(m_s ~ m_trap*1.95*.6/(3.14159*.0127^2)) %>% #*A_TS/a_trap
left_join(fitdata, by = "date") %>%
mutate_with_error(c_s ~ m_s/200/(1-exp(-k_t*6000))) %>% #intermediate step to squash error
mutate_with_error(k_s ~ c_s*k_t)
final %>%
ggplot(aes(x = pump_freq, y = k_s, ymin = k_s - 1.96*dk_s, ymax = k_s + 1.96*dk_s, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("black","blue","green","red")) +
theme_minimal()
bgvals <- final %>%
filter(dowel_density=="0000") %>%
mutate_with_error(k_bg ~ k_t - k_s) %>%
select(pump_freq, k_bg, dk_bg) %>%
arrange(pump_freq)
bgvals
final <- left_join(final, bgvals, by = "pump_freq")
final <- final %>%
mutate_with_error(k_c ~ k_t - k_s - k_bg)
final %>%
filter(dowel_density != "0000") %>%
ggplot(aes(x = pump_freq, y = k_c, ymin = k_c - 1.96*dk_c, ymax = k_c + 1.96*dk_c, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("blue","green","red")) +
theme_minimal()
#temp in flume measured at 22.2C with a calibrated thermometer
#plugged into https://www.engineeringtoolbox.com/water-dynamic-kinematic-viscosity-d_596.html
visc = 9.509e-7 #kinematic viscosity, m2/s
d = .003175 #dowel diameter
final <- final %>%
mutate(frontal_area = as.numeric(dowel_density)*.003175,
u = as.numeric(pump_freq)/500, #velocity
Re = u*.003175/visc, #Reynolds #
k_t = -t,
k_c, k_s, k_bg) %>%
mutate(eta = k_c/u/frontal_area,
deta = dk_c/u/frontal_area) %>%
mutate(eta = eta * 2.43/(1.95*.4*.6),
deta = deta * 2.43/(1.95*.4*.6)) # don't forget to correct for time out of test section!
final %>%
filter(dowel_density != "0000") %>%
ggplot(aes(x = pump_freq, y = eta, ymin = eta - 1.96*deta, ymax = eta + 1.96*deta, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("blue","green","red")) +
theme_minimal()
tibble(a = 200, b = 225, da = 5, db = 5) %>% mutate_with_error(c ~ (a+b)/2)
sd(c(200,225))
tibble(a = 1:100) %>% mutate(b = a^.65) %>%
ggplot(aes(x = a, y = b)) + geom_line()
ggplot(aes(x = a, y = b)) + geom_line() + scale_x_log10()
tibble(a = 1:100) %>% mutate(b = a^.65) %>% ggplot(aes(x = a, y = b)) + geom_line() + scale_x_log10()
knitr::opts_chunk$set(echo = TRUE, fig.pos = "!H", out.extra = "")
library(tidyverse)
pumpfiles <- list.files("../data/peristaltic pumps/")
trapfiles <- list.files("../data/sediment traps/")
pumpdate <- str_sub(pumpfiles,0,6)
trapdate <- str_sub(trapfiles,0,6)
pumpdata <- lapply(pumpfiles, function(x) read_csv(paste0("../data/peristaltic pumps/",x)))
names(pumpdata) <- pumpdate
x <- pumpdata
tidypump <- lapply(seq_along(x), function(i) {
select(x[[i]],
loc = Location,
ht = Height,
t = `time series`,
mvc = contains("(ppm)")) %>%
filter(t < 21) %>% #filter a few timepoints outside the normal window
mutate(t = (t-min(t)+1)*300, #convert from timestep to seconds
mvc = as.numeric(mvc),
date = as.numeric(names(x)[[i]])) %>%
filter(mvc<80, mvc>8) #outliers were removed based on the residual graph
}
)
pump <- bind_rows(tidypump)
pump <- pump %>%
#first 3 runs had starting sediment mass of 100g rather than 200g
filter(date > 181005) %>%
#we can't use runs without sediment mass
filter(as.character(date) %in% trapdate)
metadata <- read_csv("../data/run_metadata.csv")
pump <- left_join(pump, metadata, by = "date")
pumpfinal <- pump %>%
filter(growth_days==0, date != 190417, dowel_density != "0232")
trapdata <- lapply(trapfiles, function(x) read_csv(paste0("../data/sediment traps/",x)))
names(trapdata) <- trapdate
x <- trapdata
tidytrap <- lapply(seq_along(x), function(i) {
select(x[[i]], station = 1, pre = contains("pre"), post = contains("post"), sed = contains("sed")) %>%
mutate(date = names(x)[i]) %>%
mutate_at(vars(pre,post,sed,date), as.numeric)
}
)
trap <- bind_rows(tidytrap) %>%
filter(!is.na(sed))
trapfinal <- left_join(trap, metadata, by = "date") %>%
filter(date %in% pumpfinal$date)
mutate_with_error = function(.data, f) {
exprs = list(
# expression to compute new variable values
deparse(f[[3]]),
# expression to compute new variable errors
sapply(all.vars(f[[3]]), function(v) {
dfdp = deparse(D(f[[3]], v))
sprintf('(d%s*(%s))^2', v, dfdp)
}) %>%
paste(collapse='+') %>%
sprintf('sqrt(%s)', .)
)
names(exprs) = c(
deparse(f[[2]]),
sprintf('d%s', deparse(f[[2]]))
)
.data %>%
# the standard evaluation alternative of mutate()
mutate_(.dots=exprs)
}
library(lme4)
fits <- lmList(data = pumpfinal, log(mvc)~t | date)
summary(fits)
cbind(pumpfinal, pred = predict(fits)) %>%
ggplot() +
geom_point(aes(x = t, y = mvc), size = .75, alpha = .5) +
geom_line(aes(x = t, y = exp(pred)), color = "red") +
facet_grid(pump_freq~dowel_density) +
scale_x_continuous(breaks = c(0,3000,6000), limits = c(0,6000))
cbind(pumpfinal, resid = residuals(fits)) %>%
ggplot(aes(x = t, y = resid)) +
geom_point() +
geom_smooth()
fitdata <- coefficients(fits) %>%
mutate(k_t = -t) %>%
cbind(dk_t = summary(fits)[[4]][,,'t'][,2], date = as.numeric(row.names(coefficients(fits)))) %>%
left_join(metadata, by = "date")
fitdata %>%
ggplot(aes(x = pump_freq, y = k_t, ymin = k_t - 1.96*dk_t, ymax = k_t + 1.96*dk_t, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("black","blue","green","red")) +
theme_minimal()
final <- trapfinal %>%
group_by(date) %>%
summarise(m_trap = mean(sed)/1000,
dm_trap = sd(sed)/1000) %>% #average sediment in trap converted from mg to g
mutate_with_error(m_s ~ m_trap*1.95*.6/(3.14159*.0127^2)) %>% #*A_TS/a_trap
left_join(fitdata, by = "date") %>%
mutate_with_error(c_s ~ m_s/200/(1-exp(-k_t*6000))) %>% #intermediate step to squash error
mutate_with_error(k_s ~ c_s*k_t)
final %>%
ggplot(aes(x = pump_freq, y = k_s, ymin = k_s - 1.96*dk_s, ymax = k_s + 1.96*dk_s, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("black","blue","green","red")) +
theme_minimal()
bgvals <- final %>%
filter(dowel_density=="0000") %>%
mutate_with_error(k_bg ~ k_t - k_s) %>%
select(pump_freq, k_bg, dk_bg) %>%
arrange(pump_freq)
bgvals
final <- left_join(final, bgvals, by = "pump_freq")
final <- final %>%
mutate_with_error(k_c ~ k_t - k_s - k_bg)
final %>%
filter(dowel_density != "0000") %>%
ggplot(aes(x = pump_freq, y = k_c, ymin = k_c - 1.96*dk_c, ymax = k_c + 1.96*dk_c, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("blue","green","red")) +
theme_minimal()
#temp in flume measured at 22.2C with a calibrated thermometer
#plugged into https://www.engineeringtoolbox.com/water-dynamic-kinematic-viscosity-d_596.html
visc = 9.509e-7 #kinematic viscosity, m2/s
d = .003175 #dowel diameter
final <- final %>%
mutate(frontal_area = as.numeric(dowel_density)*.003175,
u = as.numeric(pump_freq)/500, #velocity
Re = u*.003175/visc, #Reynolds #
k_t = -t,
k_c, k_s, k_bg) %>%
mutate(eta = k_c/u/frontal_area,
deta = dk_c/u/frontal_area) %>%
mutate(eta = eta * 2.43/(1.95*.4*.6),
deta = deta * 2.43/(1.95*.4*.6)) # don't forget to correct for time out of test section!
final %>%
filter(dowel_density != "0000") %>%
ggplot(aes(x = pump_freq, y = eta, ymin = eta - 1.96*deta, ymax = eta + 1.96*deta, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("blue","green","red")) +
theme_minimal()
final
final %>%
filter(dowel_density=="0000")
final[final$date=="190802","k_t"]
final[final$date=="190802","k_t"] <- (final[final$date=="190321","k_t"] + final[final$date=="190729","k_t"])/2
final %>%
filter(dowel_density=="0000")
final[final$date=="190802","k_t"] <- (final[final$date=="190321","k_t"] + final[final$date=="190729","k_t"])/2
final[final$date=="190802","dk_t"] <- (final[final$date=="190321","dk_t"] + final[final$date=="190729","dk_t"])/2
final[final$date=="190802","m_s"] <- (final[final$date=="190321","m_s"] + final[final$date=="190729","m_s"])/2
final[final$date=="190802","dm_s"] <- (final[final$date=="190321","dm_s"] + final[final$date=="190729","dm_s"])/2
final %>%
filter(dowel_density=="0000")
final %>%
ggplot(aes(x = pump_freq, y = k_s, ymin = k_s - 1.96*dk_s, ymax = k_s + 1.96*dk_s, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("black","blue","green","red")) +
theme_minimal()
final %>%
mutate_with_error(c_s ~ m_s/200/(1-exp(-k_t*6000))) %>% #intermediate step to squash error
mutate_with_error(k_s ~ c_s*k_t)
final <- final %>%
mutate_with_error(c_s ~ m_s/200/(1-exp(-k_t*6000))) %>% #intermediate step to squash error
mutate_with_error(k_s ~ c_s*k_t)
final <- final %>%
mutate_with_error(c_s ~ m_s/200/(1-exp(-k_t*6000))) %>% #intermediate step to squash error
mutate_with_error(k_s ~ c_s*k_t)
ggplot(aes(x = pump_freq, y = k_s, ymin = k_s - 1.96*dk_s, ymax = k_s + 1.96*dk_s, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("black","blue","green","red")) +
theme_minimal()
final[final$date=="190802","k_t"] <- (final[final$date=="190321","k_t"] + final[final$date=="190729","k_t"])/2
final[final$date=="190802","dk_t"] <- (final[final$date=="190321","dk_t"] + final[final$date=="190729","dk_t"])/2
final[final$date=="190802","m_s"] <- (final[final$date=="190321","m_s"] + final[final$date=="190729","m_s"])/2
final[final$date=="190802","dm_s"] <- (final[final$date=="190321","dm_s"] + final[final$date=="190729","dm_s"])/2
final <- final %>%
mutate_with_error(c_s ~ m_s/200/(1-exp(-k_t*6000))) %>% #intermediate step to squash error
mutate_with_error(k_s ~ c_s*k_t)
final %>%
ggplot(aes(x = pump_freq, y = k_s, ymin = k_s - 1.96*dk_s, ymax = k_s + 1.96*dk_s, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("black","blue","green","red")) +
theme_minimal()
final[final$date=="190802","k_t"] <- (final[final$date=="190321","k_t"] + final[final$date=="190729","k_t"])/2
final[final$date=="190802","dk_t"] <- (final[final$date=="190321","dk_t"] + final[final$date=="190729","dk_t"])/2
final[final$date=="190802","m_s"] <- (final[final$date=="190321","m_s"] + final[final$date=="190729","m_s"])/2
final[final$date=="190802","dm_s"] <- (final[final$date=="190321","dm_s"] + final[final$date=="190729","dm_s"])/2
final <- final %>%
mutate_with_error(c_s ~ m_s/200/(1-exp(-k_t*6000))) %>% #intermediate step to squash error
mutate_with_error(k_s ~ c_s*k_t)
bgvals <- final %>%
filter(dowel_density=="0000") %>%
mutate_with_error(k_bg ~ k_t - k_s) %>%
select(pump_freq, k_bg, dk_bg) %>%
arrange(pump_freq)
bgvals
final %>%
ggplot(aes(x = pump_freq, y = k_s, ymin = k_s - 1.96*dk_s, ymax = k_s + 1.96*dk_s, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("black","blue","green","red")) +
theme_minimal()
final[final$date=="190802","k_t"] <- (final[final$date=="190321","k_t"] + final[final$date=="190729","k_t"])/2
final[final$date=="190802","dk_t"] <- (final[final$date=="190321","dk_t"] + final[final$date=="190729","dk_t"])/2
final[final$date=="190802","m_s"] <- (final[final$date=="190321","m_s"] + final[final$date=="190729","m_s"])/2
final[final$date=="190802","dm_s"] <- (final[final$date=="190321","dm_s"] + final[final$date=="190729","dm_s"])/2
final <- final %>%
mutate_with_error(c_s ~ m_s/200/(1-exp(-k_t*6000))) %>% #intermediate step to squash error
mutate_with_error(k_s ~ c_s*k_t)
bgvals <- final %>%
filter(dowel_density=="0000") %>%
mutate_with_error(k_bg ~ k_t - k_s) %>%
select(pump_freq, k_bg, dk_bg) %>%
arrange(pump_freq)
bgvals
final %>%
ggplot(aes(x = pump_freq, y = k_s, ymin = k_s - 1.96*dk_s, ymax = k_s + 1.96*dk_s, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("black","blue","green","red")) +
theme_minimal()
final <- final %>%
mutate_with_error(k_c ~ k_t - k_s - k_bg)
final %>%
filter(dowel_density != "0000") %>%
ggplot(aes(x = pump_freq, y = k_c, ymin = k_c - 1.96*dk_c, ymax = k_c + 1.96*dk_c, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("blue","green","red")) +
theme_minimal()
final <- final %>%
mutate(frontal_area = as.numeric(dowel_density)*.003175,
u = as.numeric(pump_freq)/500, #velocity
Re = u*.003175/visc, #Reynolds #
k_t = -t,
k_c, k_s, k_bg) %>%
mutate(eta = k_c/u/frontal_area,
deta = dk_c/u/frontal_area) %>%
mutate(eta = eta * 2.43/(1.95*.4*.6),
deta = deta * 2.43/(1.95*.4*.6)) # don't forget to correct for time out of test section!
final %>%
filter(dowel_density != "0000") %>%
ggplot(aes(x = pump_freq, y = eta, ymin = eta - 1.96*deta, ymax = eta + 1.96*deta, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("blue","green","red")) +
theme_minimal()
final[final$date=="190802","k_t"] <- (final[final$date=="190321","k_t"] + final[final$date=="190729","k_t"])/2
final[final$date=="190802","dk_t"] <- (final[final$date=="190321","dk_t"] + final[final$date=="190729","dk_t"])/2
final[final$date=="190802","m_s"] <- (final[final$date=="190321","m_s"] + final[final$date=="190729","m_s"])/2
final[final$date=="190802","dm_s"] <- (final[final$date=="190321","dm_s"] + final[final$date=="190729","dm_s"])/2
final <- final %>%
mutate_with_error(c_s ~ m_s/200/(1-exp(-k_t*6000))) %>% #intermediate step to squash error
mutate_with_error(k_s ~ c_s*k_t)
bgvals <- final %>%
filter(dowel_density=="0000") %>%
mutate_with_error(k_bg ~ k_t - k_s) %>%
select(pump_freq, k_bg, dk_bg) %>%
arrange(pump_freq)
bgvals
final <- left_join(final, bgvals, by = "pump_freq")
final %>%
ggplot(aes(x = pump_freq, y = k_s, ymin = k_s - 1.96*dk_s, ymax = k_s + 1.96*dk_s, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("black","blue","green","red")) +
theme_minimal()
final <- final %>%
mutate_with_error(k_c ~ k_t - k_s - k_bg)
final[final$date=="190802","k_t"] <- (final[final$date=="190321","k_t"] + final[final$date=="190729","k_t"])/2
final[final$date=="190802","dk_t"] <- (final[final$date=="190321","dk_t"] + final[final$date=="190729","dk_t"])/2
final[final$date=="190802","m_s"] <- (final[final$date=="190321","m_s"] + final[final$date=="190729","m_s"])/2
final[final$date=="190802","dm_s"] <- (final[final$date=="190321","dm_s"] + final[final$date=="190729","dm_s"])/2
final <- final %>%
mutate_with_error(c_s ~ m_s/200/(1-exp(-k_t*6000))) %>% #intermediate step to squash error
mutate_with_error(k_s ~ c_s*k_t)
bgvals <- final %>%
filter(dowel_density=="0000") %>%
mutate_with_error(k_bg ~ k_t - k_s) %>%
select(pump_freq, k_bg, dk_bg) %>%
arrange(pump_freq)
bgvals
final <- left_join(final, bgvals, by = "pump_freq")
final %>%
ggplot(aes(x = pump_freq, y = k_s, ymin = k_s - 1.96*dk_s, ymax = k_s + 1.96*dk_s, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("black","blue","green","red")) +
theme_minimal()
final <- final %>%
mutate_with_error(k_c ~ k_t - k_s - k_bg)
final %>%
filter(dowel_density != "0000") %>%
ggplot(aes(x = pump_freq, y = k_c, ymin = k_c - 1.96*dk_c, ymax = k_c + 1.96*dk_c, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("blue","green","red")) +
theme_minimal()
final <- final %>%
mutate(frontal_area = as.numeric(dowel_density)*.003175,
u = as.numeric(pump_freq)/500, #velocity
Re = u*.003175/visc, #Reynolds #
k_t = -t,
k_c, k_s, k_bg) %>%
mutate(eta = k_c/u/frontal_area,
deta = dk_c/u/frontal_area) %>%
mutate(eta = eta * 2.43/(1.95*.4*.6),
deta = deta * 2.43/(1.95*.4*.6)) # don't forget to correct for time out of test section!
final %>%
filter(dowel_density != "0000") %>%
ggplot(aes(x = pump_freq, y = eta, ymin = eta - 1.96*deta, ymax = eta + 1.96*deta, color = dowel_density)) +
geom_line(lty = "dotted", size = 2, alpha = .3) +
geom_point(position = position_dodge(width = 3)) +
geom_errorbar(width = 3, position = "dodge") +
scale_color_manual(values = c("blue","green","red")) +
theme_minimal()
View(final)
